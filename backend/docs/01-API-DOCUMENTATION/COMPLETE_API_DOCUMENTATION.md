# üìö OHT-50 Backend API - Complete Documentation

**Phi√™n b·∫£n:** 3.1  
**Ng√†y c·∫≠p nh·∫≠t:** 2025-10-08  
**Base URL:** `http://127.0.0.1:8000`  
**Total Endpoints:** 44 APIs (Core + Network)  
**WebSocket Endpoints:** 3  

---

## üéØ **T·ªîNG QUAN H·ªÜ TH·ªêNG**

OHT-50 Backend l√† h·ªá th·ªëng ƒëi·ªÅu khi·ªÉn robot t·ª± ƒë·ªông v·ªõi b·ªô **Core API + Network API (44 endpoints)** ƒë∆∞·ª£c t·ªï ch·ª©c th√†nh **7 nh√≥m ch√≠nh**:

### **üìä TH·ªêNG K√ä API**
- **üîê Authentication:** 7 endpoints
- **ü§ñ Robot Control:** 8 endpoints  
- **üìä Telemetry:** 5 endpoints
- **üõ°Ô∏è Safety:** 5 endpoints
- **üìà Monitoring:** 5 endpoints
- **üåê Network & WiFi:** 12 endpoints ‚≠ê NEW
- **üè• Health/System:** 2 endpoints
- **üåê WebSocket:** 3 endpoints

---

## üîê **AUTHENTICATION SYSTEM**

### **Base Authentication**
T·∫•t c·∫£ API endpoints (tr·ª´ `/health`) y√™u c·∫ßu JWT token:
```http
Authorization: Bearer <your_jwt_token>
```

### **Token Information**
- **Type:** JWT (JSON Web Token)
- **Expiry:** 30 ph√∫t (1800 gi√¢y)
- **Algorithm:** HS256
- **Header:** `Authorization: Bearer <token>`

---

## üè• **HEALTH & SYSTEM APIs**

### **GET /health**
**M·ª•c ƒë√≠ch:** Ki·ªÉm tra s·ª©c kh·ªèe h·ªá th·ªëng (kh√¥ng c·∫ßn authentication)

**Request:**
```http
GET /health
```

**Response:**
```json
{
  "status": "healthy",
  "timestamp": "2025-01-28T10:30:00Z",
  "version": "1.0.0",
  "checks": {
    "system": "ok",
    "database": "ok", 
    "rs485": "ok"
  }
}
```

**Example Usage:**
```bash
curl -X GET "http://127.0.0.1:8000/health"
```

### **GET /api/v1/health/detailed**
**M·ª•c ƒë√≠ch:** Th√¥ng tin chi ti·∫øt v·ªÅ s·ª©c kh·ªèe h·ªá th·ªëng

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "overall_status": "healthy",
  "system_health": "good",
  "components": {
    "database": {"status": "healthy", "response_time": 5.2},
    "firmware": {"status": "healthy", "response_time": 15.8},
    "rs485": {"status": "healthy", "active_modules": 3}
  },
  "performance": {
    "cpu_usage": 45.2,
    "memory_usage": 67.8,
    "disk_usage": 23.5
  }
}
```

---

## üîê **AUTHENTICATION APIs**

### **POST /api/v1/auth/login**
**M·ª•c ƒë√≠ch:** ƒêƒÉng nh·∫≠p v√†o h·ªá th·ªëng

**Request:**
```json
{
  "username": "admin",
  "password": "admin123"
}
```

**Response:**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "bearer",
  "expires_in": 1800,
  "user": {
    "id": 1,
    "username": "admin",
    "email": "admin@oht50.com",
    "role": "administrator"
  }
}
```

**Example Usage:**
```bash
curl -X POST "http://127.0.0.1:8000/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'
```

### **GET /api/v1/auth/me**
**M·ª•c ƒë√≠ch:** L·∫•y th√¥ng tin user hi·ªán t·∫°i

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "id": 1,
  "username": "admin",
  "email": "admin@oht50.com",
  "role": "administrator",
  "is_active": true,
  "created_at": "2025-01-28T10:00:00Z"
}
```

### **POST /api/v1/auth/logout**
**M·ª•c ƒë√≠ch:** ƒêƒÉng xu·∫•t kh·ªèi h·ªá th·ªëng

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "message": "Successfully logged out"
}
```

### **POST /api/v1/auth/register**
**M·ª•c ƒë√≠ch:** ƒêƒÉng k√Ω user m·ªõi (ch·ªâ admin)

**Headers:** `Authorization: Bearer <token>`

**Request:**
```json
{
  "username": "newuser",
  "email": "user@oht50.com",
  "password": "password123",
  "role": "operator"
}
```

**Response:**
```json
{
  "id": 2,
  "username": "newuser",
  "email": "user@oht50.com",
  "role": "operator",
  "is_active": true
}
```

### **GET /api/v1/auth/users**
**M·ª•c ƒë√≠ch:** L·∫•y danh s√°ch t·∫•t c·∫£ users (ch·ªâ admin)

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
[
  {
    "id": 1,
    "username": "admin",
    "email": "admin@oht50.com",
    "role": "administrator",
    "is_active": true
  },
  {
    "id": 2,
    "username": "operator1",
    "email": "op1@oht50.com",
    "role": "operator",
    "is_active": true
  }
]
```

---

## ü§ñ **ROBOT CONTROL APIs**

### **GET /api/v1/robot/status**
**M·ª•c ƒë√≠ch:** L·∫•y tr·∫°ng th√°i hi·ªán t·∫°i c·ªßa robot

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "robot_id": "OHT-50-001",
  "status": "idle",
  "operating_mode": "AUTO",
  "position": {
    "x": 150.5,
    "y": 200.3,
    "z": 0.0
  },
  "battery_level": 87,
  "temperature": 42.5,
  "connection_status": "connected",
  "last_update": "2025-01-28T10:30:00Z"
}
```

**Example Usage:**
```bash
curl -X GET "http://127.0.0.1:8000/api/v1/robot/status" \
  -H "Authorization: Bearer $TOKEN"
```

### **POST /api/v1/robot/control**
**M·ª•c ƒë√≠ch:** ƒêi·ªÅu khi·ªÉn robot v·ªõi l·ªánh c·ª• th·ªÉ

**Headers:** `Authorization: Bearer <token>`

**Request:**
```json
{
  "command": "move",
  "parameters": {
    "direction": "forward",
    "speed": 0.5,
    "distance": 100
  }
}
```

**Response:**
```json
{
  "success": true,
  "command_id": "cmd_12345",
  "message": "Command executed successfully",
  "execution_time": 0.15
}
```

### **POST /api/v1/robot/emergency-stop**
**M·ª•c ƒë√≠ch:** D·ª´ng kh·∫©n c·∫•p robot

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "success": true,
  "stop_time": "2025-01-28T10:35:00Z",
  "reason": "emergency_stop_activated",
  "position": {
    "x": 175.2,
    "y": 225.8
  }
}
```

### **GET /api/v1/robot/position**
**M·ª•c ƒë√≠ch:** L·∫•y v·ªã tr√≠ hi·ªán t·∫°i c·ªßa robot

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "position": {
    "x": 150.5,
    "y": 200.3,
    "z": 0.0
  },
  "orientation": 45.2,
  "accuracy": 0.1,
  "timestamp": "2025-01-28T10:30:00Z"
}
```

### **GET /api/v1/robot/battery**
**M·ª•c ƒë√≠ch:** L·∫•y th√¥ng tin pin robot

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "battery_level": 87,
  "voltage": 24.2,
  "current": 2.5,
  "temperature": 42.5,
  "charging_status": "not_charging",
  "estimated_runtime": 180
}
```

### **POST /api/v1/robot/move/forward**
**M·ª•c ƒë√≠ch:** Di chuy·ªÉn robot ti·∫øn

**Headers:** `Authorization: Bearer <token>`

**Request:**
```json
{
  "speed": 0.5,
  "distance": 100
}
```

**Response:**
```json
{
  "success": true,
  "movement_id": "move_12345",
  "estimated_duration": 20.5,
  "target_position": {
    "x": 250.5,
    "y": 200.3
  }
}
```

### **POST /api/v1/robot/move/backward**
**M·ª•c ƒë√≠ch:** Di chuy·ªÉn robot l√πi

**Headers:** `Authorization: Bearer <token>`

**Request:**
```json
{
  "speed": 0.3,
  "distance": 50
}
```

### **POST /api/v1/robot/move/stop**
**M·ª•c ƒë√≠ch:** D·ª´ng robot

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "success": true,
  "stop_time": "2025-01-28T10:35:00Z",
  "final_position": {
    "x": 175.2,
    "y": 225.8
  }
}
```

### **GET /api/v1/robot/speed**
**M·ª•c ƒë√≠ch:** L·∫•y t·ªëc ƒë·ªô hi·ªán t·∫°i c·ªßa robot

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "current_speed": 0.5,
  "max_speed": 1.0,
  "acceleration": 0.2,
  "deceleration": 0.3
}
```

### **POST /api/v1/robot/speed**
**M·ª•c ƒë√≠ch:** ƒê·∫∑t t·ªëc ƒë·ªô robot

**Headers:** `Authorization: Bearer <token>`

**Request:**
```json
{
  "speed": 0.8,
  "acceleration": 0.5
}
```

**Response:**
```json
{
  "success": true,
  "new_speed": 0.8,
  "acceleration": 0.5,
  "response_time": 0.05
}
```

---

## üìä **TELEMETRY APIs**

### **GET /api/v1/telemetry/current**
**M·ª•c ƒë√≠ch:** L·∫•y d·ªØ li·ªáu telemetry hi·ªán t·∫°i

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "timestamp": "2025-01-28T10:30:00Z",
  "robot_status": {
    "status": "idle",
    "position": {"x": 150.5, "y": 200.3},
    "battery_level": 87,
    "temperature": 42.5
  },
  "sensors": {
    "lidar": {
      "status": "active",
      "range_max": 10.0
    },
    "accelerometer": {
      "x": 0.1,
      "y": -0.2,
      "z": 9.8
    }
  },
  "performance": {
    "cpu_usage": 45.2,
    "memory_usage": 67.8,
    "network_latency": 12.5
  }
}
```

### **GET /api/v1/telemetry/history**
**M·ª•c ƒë√≠ch:** L·∫•y l·ªãch s·ª≠ telemetry

**Headers:** `Authorization: Bearer <token>`

**Query Parameters:**
- `start_time`: ISO timestamp
- `end_time`: ISO timestamp  
- `limit`: s·ªë l∆∞·ª£ng records (default: 100)

**Response:**
```json
{
  "period": {
    "start": "2025-01-28T09:00:00Z",
    "end": "2025-01-28T10:30:00Z"
  },
  "data_points": 90,
  "telemetry": [
    {
      "timestamp": "2025-01-28T09:00:00Z",
      "battery_level": 90,
      "temperature": 40.5,
      "position": {"x": 100.0, "y": 150.0}
    }
  ]
}
```

### **GET /api/v1/telemetry/summary**
**M·ª•c ƒë√≠ch:** L·∫•y t√≥m t·∫Øt th·ªëng k√™ telemetry

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "period": "last_hour",
  "total_data_points": 3600,
  "average_battery": 85.2,
  "average_temperature": 41.8,
  "total_distance": 1250.5,
  "obstacles_avoided": 12,
  "performance_score": 92.5
}
```

### **GET /api/v1/telemetry/lidar/scan**
**M·ª•c ƒë√≠ch:** L·∫•y d·ªØ li·ªáu LiDAR scan m·ªõi nh·∫•t

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "scan_id": "scan_12345",
  "timestamp": "2025-01-28T10:30:00Z",
  "point_count": 360,
  "points": [
    {"angle": 0, "distance": 5.2, "intensity": 0.8},
    {"angle": 1, "distance": 5.1, "intensity": 0.7}
  ],
  "obstacles": [
    {
      "id": "obs_1",
      "position": {"x": 2.5, "y": 3.1},
      "size": 0.5,
      "confidence": 0.95
    }
  ]
}
```

---

## üõ°Ô∏è **SAFETY APIs**

### **GET /api/v1/safety/status**
**M·ª•c ƒë√≠ch:** L·∫•y tr·∫°ng th√°i h·ªá th·ªëng an to√†n

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "safety_status": "normal",
  "emergency_stop": false,
  "safety_zones": {
    "zone_1": "clear",
    "zone_2": "clear"
  },
  "obstacle_detection": {
    "enabled": true,
    "sensitivity": "medium",
    "obstacles_count": 0
  },
  "last_safety_check": "2025-01-28T10:30:00Z"
}
```

### **POST /api/v1/safety/emergency-stop**
**M·ª•c ƒë√≠ch:** K√≠ch ho·∫°t d·ª´ng kh·∫©n c·∫•p

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "success": true,
  "emergency_stop_activated": true,
  "timestamp": "2025-01-28T10:35:00Z",
  "reason": "manual_activation",
  "robot_position": {
    "x": 175.2,
    "y": 225.8
  }
}
```

### **GET /api/v1/safety/alerts**
**M·ª•c ƒë√≠ch:** L·∫•y danh s√°ch c·∫£nh b√°o an to√†n

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "alerts": [
    {
      "id": "alert_001",
      "type": "obstacle_detected",
      "severity": "medium",
      "message": "Obstacle detected in path",
      "timestamp": "2025-01-28T10:25:00Z",
      "acknowledged": false
    }
  ],
  "total_count": 1,
  "unacknowledged_count": 1
}
```

---

## üìà **MONITORING APIs**

### **GET /api/v1/monitoring/health**
**M·ª•c ƒë√≠ch:** L·∫•y th√¥ng tin chi ti·∫øt v·ªÅ s·ª©c kh·ªèe h·ªá th·ªëng

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "system_health": {
    "overall_score": 85.5,
    "status": "healthy",
    "last_check": "2025-01-28T10:30:00Z"
  },
  "performance_metrics": {
    "cpu_usage": 45.2,
    "memory_usage": 67.8,
    "disk_usage": 23.5,
    "network_latency": 12.5
  },
  "component_status": {
    "database": {"status": "healthy", "response_time": 5.2},
    "firmware": {"status": "healthy", "response_time": 15.8},
    "websocket": {"status": "healthy", "connections": 3}
  }
}
```

### **GET /api/v1/monitoring/metrics/current**
**M·ª•c ƒë√≠ch:** L·∫•y metrics hi·ªán t·∫°i c·ªßa h·ªá th·ªëng

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "timestamp": "2025-01-28T10:30:00Z",
  "system_metrics": {
    "cpu_usage": 45.2,
    "memory_usage": 67.8,
    "disk_usage": 23.5,
    "network_io": {"bytes_sent": 1024000, "bytes_received": 2048000}
  },
  "application_metrics": {
    "active_connections": 3,
    "requests_per_second": 15.2,
    "average_response_time": 45.8,
    "error_rate": 0.02
  }
}
```

### **GET /api/v1/monitoring/alerts**
**M·ª•c ƒë√≠ch:** L·∫•y danh s√°ch alerts h·ªá th·ªëng

**Headers:** `Authorization: Bearer <token>`

**Response:**
```json
{
  "alerts": [
    {
      "id": "alert_001",
      "type": "high_cpu_usage",
      "severity": "warning",
      "message": "CPU usage above 80%",
      "timestamp": "2025-01-28T10:25:00Z",
      "acknowledged": false,
      "resolved": false
    }
  ],
  "summary": {
    "total_alerts": 1,
    "critical": 0,
    "warning": 1,
    "info": 0,
    "unacknowledged": 1
  }
}
```

---

## üåê **NETWORK & WIFI APIs (12 Endpoints)** ‚≠ê NEW

Backend Network APIs t√≠ch h·ª£p v·ªõi Firmware (port 8080) ƒë·ªÉ qu·∫£n l√Ω WiFi v√† network connectivity.

### **üìä Network Monitoring (3 endpoints - Public)**

#### **GET /api/v1/network/status**
**M√¥ t·∫£:** L·∫•y tr·∫°ng th√°i m·∫°ng hi·ªán t·∫°i  
**Auth:** ‚ùå Public  
**Integration:** ‚úÖ K·∫øt n·ªëi v·ªõi Firmware `http://localhost:8080/api/v1/network/status`

**Request:**
```bash
curl http://localhost:8000/api/v1/network/status | jq
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "connected": false,
    "current_ssid": "",
    "signal_strength": 0,
    "ip_address": "192.168.1.35",
    "gateway": "192.168.1.1",
    "dns": "8.8.8.8",
    "bytes_sent": 0,
    "bytes_received": 0,
    "latency_ms": 0,
    "roaming_active": false,
    "status": "connected",
    "ap_status": "stopped",
    "fallback_enabled": false,
    "config": {},
    "last_heartbeat": "2025-10-08T06:57:52Z",
    "connection_errors": 0
  },
  "timestamp": "2025-10-08T06:57:52Z"
}
```

**Data Fields:**
- `connected` - WiFi connection status (boolean)
- `current_ssid` - SSID ƒëang k·∫øt n·ªëi (string)
- `signal_strength` - C∆∞·ªùng ƒë·ªô t√≠n hi·ªáu dBm (int)
- `ip_address` - IP address hi·ªán t·∫°i (string)
- `gateway` - Gateway address (string)
- `dns` - DNS server (string)
- `bytes_sent/received` - Network traffic (int)
- `latency_ms` - Network latency (float)
- `status` - Backend-Firmware connection status (string)
- `ap_status` - WiFi AP mode status (string)
- `fallback_enabled` - Ch·∫ø ƒë·ªô d·ª± ph√≤ng (boolean)

---

#### **GET /api/v1/network/health**
**M√¥ t·∫£:** Ki·ªÉm tra s·ª©c kh·ªèe network service  
**Auth:** ‚ùå Public  
**Integration:** ‚úÖ Backend ‚Üí Firmware health check

**Request:**
```bash
curl http://localhost:8000/api/v1/network/health | jq
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "service": "network",
    "firmware_connected": true,
    "connection_errors": 0,
    "last_heartbeat": "2025-10-08T06:57:52Z",
    "uptime_seconds": 0,
    "memory_usage_percent": 0,
    "cpu_usage_percent": 0
  },
  "error": null,
  "timestamp": "2025-10-08T06:57:53Z"
}
```

**Health Status:**
- `healthy` - Service ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng
- `unhealthy` - Service c√≥ v·∫•n ƒë·ªÅ
- `firmware_connected: true` - K·∫øt n·ªëi v·ªõi Firmware OK
- `connection_errors: 0` - Kh√¥ng c√≥ l·ªói k·∫øt n·ªëi

---

#### **GET /api/v1/network/performance**
**M√¥ t·∫£:** L·∫•y metrics hi·ªáu su·∫•t m·∫°ng  
**Auth:** ‚ùå Public  
**Integration:** ‚úÖ Firmware performance metrics

**Request:**
```bash
curl http://localhost:8000/api/v1/network/performance | jq
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "bandwidth_mbps": 100.5,
    "latency_ms": 5.2,
    "packet_loss_percent": 0.1,
    "signal_strength_dbm": -45,
    "connection_quality": "excellent",
    "throughput_mbps": 95.3,
    "jitter_ms": 2.1,
    "uptime_seconds": 86400
  },
  "timestamp": "2025-10-08T06:57:54Z"
}
```

**Performance Metrics:**
- `bandwidth_mbps` - BƒÉng th√¥ng (Mbps)
- `latency_ms` - ƒê·ªô tr·ªÖ (milliseconds)
- `packet_loss_percent` - T·ª∑ l·ªá m·∫•t g√≥i (%)
- `signal_strength_dbm` - C∆∞·ªùng ƒë·ªô t√≠n hi·ªáu (dBm)
- `connection_quality` - Ch·∫•t l∆∞·ª£ng k·∫øt n·ªëi (excellent/good/fair/poor)
- `throughput_mbps` - Throughput th·ª±c t·∫ø (Mbps)
- `jitter_ms` - Jitter (milliseconds)
- `uptime_seconds` - Th·ªùi gian ho·∫°t ƒë·ªông (seconds)

---

### **üì° WiFi Client Management (3 endpoints)**

#### **GET /api/v1/network/wifi/scan**
**M√¥ t·∫£:** Qu√©t c√°c WiFi networks kh·∫£ d·ª•ng  
**Auth:** ‚ùå Public  
**Integration:** ‚úÖ Firmware `GET /api/v1/network/wifi/scan`

**Request:**
```bash
curl http://localhost:8000/api/v1/network/wifi/scan | jq
```

**Response (200 OK):**
```json
{
  "success": true,
  "data": {
    "networks": [
      {
        "ssid": "OHT-50-Network",
        "bssid": "00:11:22:33:44:55",
        "signal_strength": -45,
        "frequency": 5000,
        "security": "WPA2",
        "is_connected": false,
        "is_saved": false
      },
      {
        "ssid": "OHT-50-Backup",
        "bssid": "00:11:22:33:44:66",
        "signal_strength": -55,
        "frequency": 2400,
        "security": "WPA3",
        "is_connected": false,
        "is_saved": false
      }
    ],
    "network_count": 5
  },
  "timestamp": "2025-10-08T06:57:55Z"
}
```

**WiFi Network Fields:**
- `ssid` - T√™n WiFi network (string)
- `bssid` - MAC address c·ªßa Access Point (string)
- `signal_strength` - C∆∞·ªùng ƒë·ªô t√≠n hi·ªáu dBm (int, -100 to 0)
- `frequency` - T·∫ßn s·ªë MHz (2400=2.4GHz, 5000=5GHz)
- `security` - Lo·∫°i b·∫£o m·∫≠t (WPA2/WPA3/Open)
- `is_connected` - ƒêang k·∫øt n·ªëi v·ªõi network n√†y (boolean)
- `is_saved` - Network ƒë√£ ƒë∆∞·ª£c l∆∞u (boolean)

---

#### **POST /api/v1/network/wifi/connect**
**M√¥ t·∫£:** K·∫øt n·ªëi ƒë·∫øn WiFi network  
**Auth:** ‚úÖ ADMIN Token Required  
**Integration:** ‚úÖ Firmware `POST /api/v1/network/wifi/connect`

**Request:**
```bash
curl -X POST http://localhost:8000/api/v1/network/wifi/connect \
  -H "Authorization: Bearer oht50_admin_token_2025" \
  -H "Content-Type: application/json" \
  -d '{
    "ssid": "Factory-WiFi",
    "password": "SecurePassword123",
    "security": "WPA2"
  }' | jq
```

**Request Body:**
```json
{
  "ssid": "Factory-WiFi",
  "password": "SecurePassword123",
  "security": "WPA2"
}
```

**Response (200 OK):**
```json
{
  "success": true,
  "message": "Connected to Factory-WiFi",
  "data": {
    "ssid": "Factory-WiFi",
    "ip_address": "192.168.1.50",
    "signal_strength": -45,
    "connected_at": "2025-10-08T07:00:00Z"
  },
  "timestamp": "2025-10-08T07:00:00Z"
}
```

**Error Response (500):**
```json
{
  "success": false,
  "message": "Failed to connect to WiFi",
  "error": "Connection timeout"
}
```

---

#### **POST /api/v1/network/wifi/disconnect**
**M√¥ t·∫£:** Ng·∫Øt k·∫øt n·ªëi WiFi hi·ªán t·∫°i  
**Auth:** ‚úÖ ADMIN Token Required  
**Integration:** ‚úÖ Firmware `POST /api/v1/network/wifi/disconnect`

**Request:**
```bash
curl -X POST http://localhost:8000/api/v1/network/wifi/disconnect \
  -H "Authorization: Bearer oht50_admin_token_2025" | jq
```

**Response (200 OK):**
```json
{
  "success": true,
  "message": "Disconnected from WiFi",
  "timestamp": "2025-10-08T07:05:00Z"
}
```

---

### **üì± WiFi Access Point Management (4 endpoints)**

#### **POST /api/v1/network/ap/start**
**M√¥ t·∫£:** Kh·ªüi ƒë·ªông WiFi AP mode  
**Auth:** ‚úÖ ADMIN Token Required  
**Integration:** ‚úÖ Firmware `POST /api/v1/network/ap/start`

**Request:**
```bash
curl -X POST http://localhost:8000/api/v1/network/ap/start \
  -H "Authorization: Bearer oht50_admin_token_2025" \
  -H "Content-Type: application/json" \
  -d '{
    "ssid": "OHT-50-AP",
    "password": "OhtPass123!",
    "channel": 6,
    "security": "WPA2",
    "hidden": false,
    "max_clients": 10
  }' | jq
```

**Request Body:**
```json
{
  "ssid": "OHT-50-AP",
  "password": "OhtPass123!",
  "channel": 6,
  "security": "WPA2",
  "hidden": false,
  "max_clients": 10
}
```

**Password Requirements:**
- Minimum 8 characters
- Recommended: 12+ characters v·ªõi uppercase, lowercase, numbers, special chars

**Response (200 OK):**
```json
{
  "success": true,
  "message": "WiFi AP started successfully",
  "data": {
    "ssid": "OHT-50-AP",
    "ip_address": "192.168.4.1",
    "channel": 6,
    "security": "WPA2",
    "max_clients": 10,
    "started_at": "2025-10-08T07:10:00Z"
  },
  "timestamp": "2025-10-08T07:10:00Z"
}
```

**Use Cases:**
- K·∫øt n·ªëi Mobile App khi kh√¥ng c√≥ WiFi
- Remote access trong emergency
- Commissioning v√† maintenance
- Backup connectivity

---

#### **POST /api/v1/network/ap/stop**
**M√¥ t·∫£:** D·ª´ng WiFi AP mode  
**Auth:** ‚úÖ ADMIN Token Required  
**Integration:** ‚úÖ Firmware `POST /api/v1/network/ap/stop`

**Request:**
```bash
curl -X POST http://localhost:8000/api/v1/network/ap/stop \
  -H "Authorization: Bearer oht50_admin_token_2025" | jq
```

**Response (200 OK):**
```json
{
  "success": true,
  "message": "WiFi AP stopped successfully",
  "timestamp": "2025-10-08T07:15:00Z"
}
```

---

#### **POST /api/v1/network/ap/config**
**M√¥ t·∫£:** C·∫•u h√¨nh WiFi AP settings  
**Auth:** ‚úÖ ADMIN Token Required  
**Integration:** ‚úÖ Firmware `POST /api/v1/network/ap/config`

**Request:**
```bash
curl -X POST http://localhost:8000/api/v1/network/ap/config \
  -H "Authorization: Bearer oht50_admin_token_2025" \
  -H "Content-Type: application/json" \
  -d '{
    "ssid": "OHT-50-AP-Updated",
    "channel": 11,
    "max_clients": 20
  }' | jq
```

**Request Body (all fields optional):**
```json
{
  "ssid": "OHT-50-AP-Updated",
  "password": "NewPassword123!",
  "channel": 11,
  "security": "WPA2",
  "hidden": false,
  "max_clients": 20,
  "bandwidth_limit": 100
}
```

**Response (200 OK):**
```json
{
  "success": true,
  "message": "AP configuration updated",
  "data": {
    "ssid": "OHT-50-AP-Updated",
    "channel": 11,
    "max_clients": 20
  },
  "timestamp": "2025-10-08T07:20:00Z"
}
```

---

#### **GET /api/v1/network/ap/clients**
**M√¥ t·∫£:** L·∫•y danh s√°ch devices k·∫øt n·ªëi v√†o AP  
**Auth:** ‚ùå Public  
**Integration:** ‚úÖ Firmware `GET /api/v1/network/ap/clients`

**Request:**
```bash
curl http://localhost:8000/api/v1/network/ap/clients | jq
```

**Response (200 OK - No clients):**
```json
{
  "success": true,
  "data": {
    "clients": [],
    "client_count": 0
  },
  "timestamp": "2025-10-08T07:25:00Z"
}
```

**Response (200 OK - With clients):**
```json
{
  "success": true,
  "data": {
    "clients": [
      {
        "mac_address": "AA:BB:CC:DD:EE:22",
        "ip_address": "192.168.4.2",
        "hostname": "mobile-phone",
        "device_type": "mobile",
        "signal_strength": -40,
        "connected_at": "2025-10-08T07:20:00Z",
        "last_seen": "2025-10-08T07:25:00Z",
        "bytes_sent": 1024000,
        "bytes_received": 512000,
        "session_duration": 300,
        "is_connected": true,
        "is_blocked": false
      }
    ],
    "client_count": 1
  },
  "timestamp": "2025-10-08T07:25:00Z"
}
```

**AP Client Fields:**
- `mac_address` - MAC address c·ªßa client (string)
- `ip_address` - IP ƒë∆∞·ª£c c·∫•p cho client (string)
- `hostname` - Hostname c·ªßa device (string)
- `device_type` - Lo·∫°i thi·∫øt b·ªã: mobile/laptop/tablet (string)
- `signal_strength` - C∆∞·ªùng ƒë·ªô t√≠n hi·ªáu dBm (int)
- `connected_at` - Th·ªùi ƒëi·ªÉm k·∫øt n·ªëi (ISO timestamp)
- `last_seen` - L·∫ßn cu·ªëi th·∫•y device (ISO timestamp)
- `bytes_sent/received` - Data usage (bytes)
- `session_duration` - Th·ªùi gian k·∫øt n·ªëi (seconds)
- `is_connected` - V·∫´n ƒëang k·∫øt n·ªëi (boolean)
- `is_blocked` - Device b·ªã block (boolean)

---

### **üîÑ Fallback Connectivity (2 endpoints)**

#### **POST /api/v1/network/fallback/enable**
**M√¥ t·∫£:** B·∫≠t ch·∫ø ƒë·ªô d·ª± ph√≤ng (Ethernet ‚Üí WiFi auto-failover)  
**Auth:** ‚úÖ ADMIN Token Required  
**Integration:** ‚úÖ Firmware `POST /api/v1/network/fallback/enable`

**Request:**
```bash
curl -X POST http://localhost:8000/api/v1/network/fallback/enable \
  -H "Authorization: Bearer oht50_admin_token_2025" | jq
```

**Response (200 OK):**
```json
{
  "success": true,
  "message": "Fallback connectivity enabled",
  "data": {
    "fallback_enabled": true,
    "primary_interface": "ethernet",
    "backup_interface": "wifi",
    "auto_failover": true,
    "failover_timeout_ms": 5000
  },
  "timestamp": "2025-10-08T07:30:00Z"
}
```

**Fallback Features:**
- Auto-failover khi Ethernet m·∫•t k·∫øt n·ªëi
- T·ª± ƒë·ªông switch sang WiFi backup
- T·ª± ƒë·ªông switch l·∫°i Ethernet khi available
- Configurable failover timeout

---

#### **POST /api/v1/network/fallback/disable**
**M√¥ t·∫£:** T·∫Øt ch·∫ø ƒë·ªô d·ª± ph√≤ng  
**Auth:** ‚úÖ ADMIN Token Required  
**Integration:** ‚úÖ Firmware `POST /api/v1/network/fallback/disable`

**Request:**
```bash
curl -X POST http://localhost:8000/api/v1/network/fallback/disable \
  -H "Authorization: Bearer oht50_admin_token_2025" | jq
```

**Response (200 OK):**
```json
{
  "success": true,
  "message": "Fallback connectivity disabled",
  "timestamp": "2025-10-08T07:35:00Z"
}
```

---

## üîë **NETWORK AUTHENTICATION**

### **Admin Token (cho c√°c operations nh∆∞ AP start/stop, WiFi connect):**
```bash
ADMIN_TOKEN="oht50_admin_token_2025"

# Usage:
curl -H "Authorization: Bearer oht50_admin_token_2025" \
     http://localhost:8000/api/v1/network/ap/start
```

### **Protected Network Endpoints:**
- üî¥ `POST /network/wifi/connect` - ADMIN
- üî¥ `POST /network/wifi/disconnect` - ADMIN
- üî¥ `POST /network/ap/start` - ADMIN
- üî¥ `POST /network/ap/stop` - ADMIN
- üî¥ `POST /network/ap/config` - ADMIN
- üî¥ `POST /network/fallback/enable` - ADMIN
- üî¥ `POST /network/fallback/disable` - ADMIN

### **Public Network Endpoints:**
- üîµ `GET /network/status` - Public
- üîµ `GET /network/health` - Public
- üîµ `GET /network/performance` - Public
- üîµ `GET /network/wifi/scan` - Public
- üîµ `GET /network/ap/clients` - Public

---

## üìä **NETWORK API INTEGRATION FLOW**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     FRONTEND (Dashboard/Mobile)        ‚îÇ
‚îÇ     WiFi Settings, AP Mode Control     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ HTTP/REST
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   BACKEND (Python FastAPI) - Port 8000‚îÇ
‚îÇ   ‚úÖ 12 Network API Endpoints          ‚îÇ
‚îÇ   ‚úÖ Network Integration Service       ‚îÇ
‚îÇ   ‚úÖ FW Client (HTTP)                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ HTTP API
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   FIRMWARE (C Service) - Port 8080    ‚îÇ
‚îÇ   ‚úÖ 27 Network API Endpoints          ‚îÇ
‚îÇ   ‚úÖ WiFi Management                   ‚îÇ
‚îÇ   ‚úÖ AP Mode Control                   ‚îÇ
‚îÇ   ‚úÖ Hardware Interface                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ **NETWORK API TESTING EXAMPLES**

### **Test Script: Full Network API Testing**

```bash
#!/bin/bash
BASE_URL="http://localhost:8000/api/v1"
ADMIN_TOKEN="oht50_admin_token_2025"

echo "=== üîµ TEST 1: Network Status ==="
curl -s $BASE_URL/network/status | jq .

echo -e "\n=== üîµ TEST 2: Network Health ==="
curl -s $BASE_URL/network/health | jq .

echo -e "\n=== üîµ TEST 3: Network Performance ==="
curl -s $BASE_URL/network/performance | jq .

echo -e "\n=== üü¢ TEST 4: WiFi Scan ==="
curl -s $BASE_URL/network/wifi/scan | jq '.data.networks[0:2]'

echo -e "\n=== üü¢ TEST 5: WiFi Connect ==="
curl -s -X POST $BASE_URL/network/wifi/connect \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "ssid": "TestNetwork",
    "password": "SecurePass@2025",
    "security": "WPA2"
  }' | jq .

echo -e "\n=== üü° TEST 6: Start AP Mode ==="
curl -s -X POST $BASE_URL/network/ap/start \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "ssid": "OHT-50-TEST",
    "password": "TestPass123!",
    "channel": 6,
    "security": "WPA2",
    "hidden": false,
    "max_clients": 10
  }' | jq .

sleep 5

echo -e "\n=== üü° TEST 7: Get AP Clients ==="
curl -s $BASE_URL/network/ap/clients | jq .

echo -e "\n=== üü° TEST 8: Stop AP Mode ==="
curl -s -X POST $BASE_URL/network/ap/stop \
  -H "Authorization: Bearer $ADMIN_TOKEN" | jq .

echo -e "\n=== üü£ TEST 9: Enable Fallback ==="
curl -s -X POST $BASE_URL/network/fallback/enable \
  -H "Authorization: Bearer $ADMIN_TOKEN" | jq .

echo -e "\n=== üü£ TEST 10: Disable Fallback ==="
curl -s -X POST $BASE_URL/network/fallback/disable \
  -H "Authorization: Bearer $ADMIN_TOKEN" | jq .
```

---

<!-- RS485 section removed in Core API mode -->

## üåê **WEBSOCKET ENDPOINTS**

### **ws://127.0.0.1:8000/ws/telemetry**
**M·ª•c ƒë√≠ch:** Real-time telemetry data stream

**Authentication:** JWT token trong query parameter
```
ws://127.0.0.1:8000/ws/telemetry?token=<jwt_token>
```

**Message Format:**
```json
{
  "type": "telemetry",
  "timestamp": "2025-01-28T10:30:00Z",
  "data": {
    "robot_status": "idle",
    "battery_level": 87,
    "temperature": 42.5,
    "position": {"x": 150.5, "y": 200.3}
  }
}
```

### **ws://127.0.0.1:8000/ws/status**
**M·ª•c ƒë√≠ch:** Real-time status updates

**Authentication:** JWT token trong query parameter
```
ws://127.0.0.1:8000/ws/status?token=<jwt_token>
```

**Message Format:**
```json
{
  "type": "status_update",
  "timestamp": "2025-01-28T10:30:00Z",
  "data": {
    "robot_id": "OHT-50-001",
    "status": "moving",
    "operating_mode": "AUTO",
    "alerts": []
  }
}
```

<!-- RS485 WebSocket removed in Core API mode -->

---

## üîí **ERROR CODES & RESPONSES**

### **HTTP Status Codes**
| Code | M√¥ t·∫£ | Nguy√™n nh√¢n |
|------|-------|-------------|
| `200` | OK | Request th√†nh c√¥ng |
| `201` | Created | Resource ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng |
| `400` | Bad Request | Request kh√¥ng h·ª£p l·ªá |
| `401` | Unauthorized | Token kh√¥ng h·ª£p l·ªá ho·∫∑c h·∫øt h·∫°n |
| `403` | Forbidden | Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p |
| `404` | Not Found | Resource kh√¥ng t·ªìn t·∫°i |
| `422` | Unprocessable Entity | D·ªØ li·ªáu validation l·ªói |
| `500` | Internal Server Error | L·ªói server |

### **Error Response Format**
```json
{
  "error": {
    "code": "INVALID_TOKEN",
    "message": "Token has expired",
    "details": "Token expired at 2025-01-28T10:00:00Z"
  },
  "timestamp": "2025-01-28T10:30:00Z",
  "request_id": "req_12345"
}
```

---

## üìä **RATE LIMITING**

### **Rate Limits**
- **Authentication endpoints:** 10 requests/minute
- **Robot control endpoints:** 100 requests/minute
- **Telemetry endpoints:** 1000 requests/minute
- **Monitoring endpoints:** 200 requests/minute

### **Rate Limit Headers**
```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1640995200
```

---

## üß™ **TESTING EXAMPLES**

### **Complete Test Script**
```bash
#!/bin/bash

# Base URL
BASE_URL="http://127.0.0.1:8000"

# 1. Health Check
echo "=== Health Check ==="
curl -X GET "$BASE_URL/health"

# 2. Login
echo -e "\n=== Login ==="
TOKEN=$(curl -s -X POST "$BASE_URL/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}' | \
  jq -r '.access_token')

echo "Token: $TOKEN"

# 3. Robot Status
echo -e "\n=== Robot Status ==="
curl -X GET "$BASE_URL/api/v1/robot/status" \
  -H "Authorization: Bearer $TOKEN"

# 4. Telemetry
echo -e "\n=== Telemetry ==="
curl -X GET "$BASE_URL/api/v1/telemetry/current" \
  -H "Authorization: Bearer $TOKEN"

# 5. Safety Status
echo -e "\n=== Safety Status ==="
curl -X GET "$BASE_URL/api/v1/safety/status" \
  -H "Authorization: Bearer $TOKEN"
```

### **Python Test Script**
```python
import requests
import json

# Configuration
BASE_URL = "http://127.0.0.1:8000"
USERNAME = "admin"
PASSWORD = "admin123"

# Login
def login():
    response = requests.post(f"{BASE_URL}/api/v1/auth/login", 
                           json={"username": USERNAME, "password": PASSWORD})
    return response.json()["access_token"]

# Test API
def test_api(token):
    headers = {"Authorization": f"Bearer {token}"}
    
    # Health check
    health = requests.get(f"{BASE_URL}/health")
    print(f"Health: {health.json()}")
    
    # Robot status
    robot = requests.get(f"{BASE_URL}/api/v1/robot/status", headers=headers)
    print(f"Robot: {robot.json()}")
    
    # Telemetry
    telemetry = requests.get(f"{BASE_URL}/api/v1/telemetry/current", headers=headers)
    print(f"Telemetry: {telemetry.json()}")

# Run tests
if __name__ == "__main__":
    token = login()
    test_api(token)
```

---

## üìö **ADDITIONAL RESOURCES**

### **Interactive Documentation**
- **Swagger UI:** http://127.0.0.1:8000/docs
- **ReDoc:** http://127.0.0.1:8000/redoc

### **SDK v√† Libraries**
- **Python:** `httpx`, `websockets`
- **JavaScript:** `axios`, `ws`
- **cURL:** Examples trong documentation

### **Support**
- **Documentation:** This file v√† Swagger UI
- **Issues:** GitHub Issues
- **Team:** Backend Development Team

---

## üìä **API SUMMARY**

### **Total Endpoints: 100+**
- **Authentication:** 7 endpoints
- **Robot Control:** 25 endpoints
- **Telemetry:** 15 endpoints
- **Safety:** 5 endpoints
- **Monitoring:** 15 endpoints
- **RS485:** 20 endpoints
- **System:** 10 endpoints
- **WebSocket:** 3 endpoints

### **Performance Targets**
- **API Response Time:** < 50ms
- **WebSocket Latency:** < 20ms
- **Database Queries:** < 10ms
- **System Uptime:** > 99.9%

---

**üìÖ Last Updated:** 2025-01-28  
**üöÄ API Version:** v1  
**üìä Total Endpoints:** 100+  
**üîó Base URL:** http://127.0.0.1:8000  
**üìö Documentation:** Complete & Tested
