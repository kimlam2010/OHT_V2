# Makefile for Enhanced LiDAR HAL Test
# Version: 2.3.0
# Date: 2025-01-28
# Team: EMBED

CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -O2 -g
INCLUDES = -I../../../src/hal/peripherals -I../../../src/hal/common
LIBS = -lpthread -lm

# Build directory
BUILD_DIR = ../../../build/hal/peripherals
SRC_DIR = ../../../src/hal/peripherals
COMMON_DIR = ../../../src/hal/common

# Source files
HAL_SOURCES = $(SRC_DIR)/hal_lidar.c
TEST_SOURCES = test_lidar_enhanced.c
ADVANCED_TEST_SOURCES = test_lidar_advanced.c
MULTITHREADING_TEST_SOURCES = test_lidar_multithreading.c
ADAPTIVE_TEST_SOURCES = test_lidar_adaptive.c
UNIT_TEST_SOURCES = test_lidar_simple_unit_tests.c
PERFORMANCE_TEST_SOURCES = test_lidar_performance_benchmarks.c
COMMON_SOURCES = $(COMMON_DIR)/hal_common.c

# Object files - Táº¤T Cáº¢ VÃ€O BUILD_DIR
HAL_OBJECTS = $(BUILD_DIR)/hal_lidar.o
TEST_OBJECTS = $(BUILD_DIR)/test_lidar_enhanced.o
ADVANCED_TEST_OBJECTS = $(BUILD_DIR)/test_lidar_advanced.o
MULTITHREADING_TEST_OBJECTS = $(BUILD_DIR)/test_lidar_multithreading.o
ADAPTIVE_TEST_OBJECTS = $(BUILD_DIR)/test_lidar_adaptive.o
UNIT_TEST_OBJECTS = $(BUILD_DIR)/test_lidar_unit_tests.o
PERFORMANCE_TEST_OBJECTS = $(BUILD_DIR)/test_lidar_performance_benchmarks.o
COMMON_OBJECTS = $(BUILD_DIR)/hal_common.o

# Target executables - VÃ€O BUILD_DIR
TARGET = $(BUILD_DIR)/test_lidar_enhanced
ADVANCED_TARGET = $(BUILD_DIR)/test_lidar_advanced
MULTITHREADING_TARGET = $(BUILD_DIR)/test_lidar_multithreading
ADAPTIVE_TARGET = $(BUILD_DIR)/test_lidar_adaptive
UNIT_TEST_TARGET = $(BUILD_DIR)/test_lidar_unit_tests
PERFORMANCE_TEST_TARGET = $(BUILD_DIR)/test_lidar_performance_benchmarks

# Default target
all: $(BUILD_DIR) $(TARGET) $(ADVANCED_TARGET) $(MULTITHREADING_TARGET) $(ADAPTIVE_TARGET) $(UNIT_TEST_TARGET) $(PERFORMANCE_TEST_TARGET)

# Create build directory
$(BUILD_DIR):
	mkdir -p $(BUILD_DIR)

# Build rules - Táº¤T Cáº¢ .o VÃ€O BUILD_DIR
$(BUILD_DIR)/hal_lidar.o: $(SRC_DIR)/hal_lidar.c $(SRC_DIR)/hal_lidar.h $(COMMON_DIR)/hal_common.h
	@echo "ðŸ“¦ Compiling hal_lidar.c..."
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

$(BUILD_DIR)/test_lidar_enhanced.o: test_lidar_enhanced.c $(SRC_DIR)/hal_lidar.h
	@echo "ðŸ§ª Compiling test_lidar_enhanced.c..."
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

$(BUILD_DIR)/test_lidar_advanced.o: test_lidar_advanced.c $(SRC_DIR)/hal_lidar.h
	@echo "ðŸ§ª Compiling test_lidar_advanced.c..."
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

$(BUILD_DIR)/test_lidar_multithreading.o: test_lidar_multithreading.c $(SRC_DIR)/hal_lidar.h
	@echo "ðŸ§ª Compiling test_lidar_multithreading.c..."
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

$(BUILD_DIR)/test_lidar_adaptive.o: test_lidar_adaptive.c $(SRC_DIR)/hal_lidar.h
	@echo "ðŸ§ª Compiling test_lidar_adaptive.c..."
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

$(BUILD_DIR)/test_lidar_unit_tests.o: test_lidar_simple_unit_tests.c $(SRC_DIR)/hal_lidar.h
	@echo "ðŸ§ª Compiling test_lidar_simple_unit_tests.c..."
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

$(BUILD_DIR)/test_lidar_performance_benchmarks.o: test_lidar_performance_benchmarks.c $(SRC_DIR)/hal_lidar.h
	@echo "ðŸ§ª Compiling test_lidar_performance_benchmarks.c..."
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

$(BUILD_DIR)/hal_common.o: $(COMMON_DIR)/hal_common.c $(COMMON_DIR)/hal_common.h
	@echo "ðŸ”§ Compiling hal_common.c..."
	$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

# Build executables
$(TARGET): $(HAL_OBJECTS) $(TEST_OBJECTS) $(COMMON_OBJECTS)
	@echo "ðŸ”¨ Building Enhanced LiDAR HAL Test..."
	$(CC) $(CFLAGS) $(INCLUDES) -o $@ $^ $(LIBS)
	@echo "âœ… Enhanced test build completed successfully!"

$(ADVANCED_TARGET): $(HAL_OBJECTS) $(ADVANCED_TEST_OBJECTS) $(COMMON_OBJECTS)
	@echo "ðŸ”¨ Building Advanced LiDAR HAL Test..."
	$(CC) $(CFLAGS) $(INCLUDES) -o $@ $^ $(LIBS)
	@echo "âœ… Advanced test build completed successfully!"

$(MULTITHREADING_TARGET): $(HAL_OBJECTS) $(MULTITHREADING_TEST_OBJECTS) $(COMMON_OBJECTS)
	@echo "ðŸ”¨ Building Multi-Threading LiDAR HAL Test..."
	$(CC) $(CFLAGS) $(INCLUDES) -o $@ $^ $(LIBS)
	@echo "âœ… Multi-threading test build completed successfully!"

$(ADAPTIVE_TARGET): $(HAL_OBJECTS) $(ADAPTIVE_TEST_OBJECTS) $(COMMON_OBJECTS)
	@echo "ðŸ”¨ Building Adaptive Processing LiDAR HAL Test..."
	$(CC) $(CFLAGS) $(INCLUDES) -o $@ $^ $(LIBS)
	@echo "âœ… Adaptive processing test build completed successfully!"

$(UNIT_TEST_TARGET): $(HAL_OBJECTS) $(UNIT_TEST_OBJECTS) $(COMMON_OBJECTS)
	@echo "ðŸ”¨ Building Unit Tests LiDAR HAL Test..."
	$(CC) $(CFLAGS) $(INCLUDES) -o $@ $^ $(LIBS)
	@echo "âœ… Unit tests build completed successfully!"

$(PERFORMANCE_TEST_TARGET): $(HAL_OBJECTS) $(PERFORMANCE_TEST_OBJECTS) $(COMMON_OBJECTS)
	@echo "ðŸ”¨ Building Performance Benchmarks LiDAR HAL Test..."
	$(CC) $(CFLAGS) $(INCLUDES) -o $@ $^ $(LIBS)
	@echo "âœ… Performance benchmarks build completed successfully!"

# Test targets
test: $(TARGET)
	@echo "ðŸš€ Running Enhanced LiDAR HAL Tests..."
	@echo "====================================="
	$(BUILD_DIR)/test_lidar_enhanced

test-advanced: $(ADVANCED_TARGET)
	@echo "ðŸš€ Running Advanced LiDAR HAL Tests..."
	@echo "======================================"
	$(BUILD_DIR)/test_lidar_advanced

test-multithreading: $(MULTITHREADING_TARGET)
	@echo "ðŸš€ Running Multi-Threading LiDAR HAL Tests..."
	@echo "============================================="
	$(BUILD_DIR)/test_lidar_multithreading

test-adaptive: $(ADAPTIVE_TARGET)
	@echo "ðŸš€ Running Adaptive Processing LiDAR HAL Tests..."
	@echo "================================================="
	$(BUILD_DIR)/test_lidar_adaptive

test-unit: $(UNIT_TEST_TARGET)
	@echo "ðŸš€ Running Unit Tests LiDAR HAL Tests..."
	@echo "========================================"
	$(BUILD_DIR)/test_lidar_unit_tests

test-performance: $(PERFORMANCE_TEST_TARGET)
	@echo "ðŸš€ Running Performance Benchmarks LiDAR HAL Tests..."
	@echo "===================================================="
	$(BUILD_DIR)/test_lidar_performance_benchmarks

test-all: test test-advanced test-multithreading test-adaptive test-unit test-performance

# Clean build artifacts - CHá»ˆ XÃ“A BUILD_DIR
clean:
	@echo "ðŸ§¹ Cleaning build artifacts..."
	rm -rf $(BUILD_DIR)
	@echo "âœ… Clean completed!"

# Show help
help:
	@echo "Enhanced LiDAR HAL Test Makefile v2.3.0"
	@echo "========================================"
	@echo "Available targets:"
	@echo "  all                - Build all test executables (default)"
	@echo "  test               - Build and run enhanced tests"
	@echo "  test-advanced      - Build and run advanced tests"
	@echo "  test-multithreading - Build and run multi-threading tests"
	@echo "  test-adaptive      - Build and run adaptive processing tests"
	@echo "  test-unit          - Build and run unit tests"
	@echo "  test-performance   - Build and run performance benchmarks"
	@echo "  test-all           - Build and run all tests"
	@echo "  clean              - Remove build artifacts"
	@echo "  help               - Show this help"
	@echo ""
	@echo "Usage:"
	@echo "  make                    # Build all test executables"
	@echo "  make test               # Build and run enhanced tests"
	@echo "  make test-advanced      # Build and run advanced tests"
	@echo "  make test-multithreading # Build and run multi-threading tests"
	@echo "  make test-adaptive      # Build and run adaptive processing tests"
	@echo "  make test-unit          # Build and run unit tests"
	@echo "  make test-performance   # Build and run performance benchmarks"
	@echo "  make test-all           # Build and run all tests"
	@echo "  make clean              # Clean build artifacts"

# Phony targets
.PHONY: all test test-advanced test-multithreading test-adaptive test-unit test-performance test-all clean help