# Plan Ti·∫øn ƒë·ªô API Integration Implementation - OHT-50 Master Module

**Phi√™n b·∫£n:** 2.0.0  
**Ng√†y c·∫≠p nh·∫≠t:** 2025-01-28  
**Team:** FW  
**M·ª©c ƒë·ªô ∆∞u ti√™n:** CRITICAL  
**Tr·∫°ng th√°i:** INTEGRATED WITH PROJECT SLC PLANNING

## üîó **INTEGRATION WITH PROJECT SLC PLANNING**

**Related Document:** `/docs/03-ARCHITECTURE/architecture/SLC_PLANNING_OHT-50.md`

### **Project SLC Integration:**
- **Project Phase 3:** Implementation (In Progress - Module Data API)
- **Firmware Sprint 1-3:** Aligned v·ªõi Project Sprint 1-3
- **Timeline:** 6 weeks firmware implementation
- **Scope:** Module Data API implementation

---

## üìã **T·ªïng quan Plan**

### **M·ª•c ti√™u**
Implement l·∫°i ho√†n to√†n h·ªá th·ªëng API cho OHT-50 Master Module theo ƒë√∫ng y√™u c·∫ßu v√† ki·∫øn tr√∫c ƒë√£ ƒë·ªãnh nghƒ©a.

### **Ph·∫°m vi**
- Core API Manager implementation
- HTTP REST API endpoints
- WebSocket real-time communication
- Integration v·ªõi core systems
- Module-specific endpoints
- Security v√† authentication

---

## üö® **CRITICAL ISSUE IDENTIFIED - IMMEDIATE ACTION REQUIRED**

### **Issue: API Manager NOT Integrated v√†o main.c**
- **Problem:** API Manager implemented but not used in main.c
- **Root Cause:** main.c still uses Communication Manager API placeholders
- **Impact:** FW cannot communicate with BE, blocking development
- **Priority:** CRITICAL
- **Timeline:** 3 days to fix

---

## üéØ **Phase 1: CRITICAL FIX - API Manager Integration (IMMEDIATE)**
**ALIGNED WITH PROJECT SPRINT 1: CRITICAL FIX - FW-BE Communication**

### **Task 1.1: Integrate API Manager v√†o main.c**
**Th·ªùi gian:** 1 ng√†y  
**Responsible:** FW Team  
**Dependencies:** None  
**Project Sprint:** Sprint 1 - CRITICAL FIX
**Priority:** CRITICAL

**Deliverables:**
- **CRITICAL:** Replace Communication Manager API calls trong main.c
- **CRITICAL:** Add API Manager init/start v√†o main.c
- **CRITICAL:** Update main loop v·ªõi API Manager processing
- **CRITICAL:** Remove API placeholder functions
- **CRITICAL:** Enable real HTTP/WebSocket servers

**Acceptance Criteria:**
- [ ] **CRITICAL:** FW starts without errors
- [ ] **CRITICAL:** Port 8080 actually listening (not simulated)
- [ ] **CRITICAL:** Port 8081 actually listening (not simulated)
- [ ] **CRITICAL:** API endpoints respond to HTTP requests
- [ ] **CRITICAL:** WebSocket connections work
- [ ] **CRITICAL:** BE can communicate with FW
- [ ] **CRITICAL:** End-to-end communication validated
- [ ] Basic error handling

### **Task 1.2: HTTP Server Foundation**
**Th·ªùi gian:** 4 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Task 1.1

**Deliverables:**
- `src/app/http_server.h` - HTTP Server interface
- `src/app/http_server.c` - HTTP Server implementation
- Basic HTTP request/response handling
- Route management system
- Port 8080 configuration

**Acceptance Criteria:**
- [ ] HTTP server start/stop ho·∫°t ƒë·ªông
- [ ] Route registration system ho·∫°t ƒë·ªông
- [ ] Basic request/response handling
- [ ] Port 8080 accessible

### **Task 1.3: WebSocket Server Foundation**
**Th·ªùi gian:** 3 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Task 1.1

**Deliverables:**
- `src/app/websocket_server.h` - WebSocket Server interface
- `src/app/websocket_server.c` - WebSocket Server implementation
- WebSocket protocol handling
- Client connection management
- Port 8081 configuration

**Acceptance Criteria:**
- [ ] WebSocket server start/stop ho·∫°t ƒë·ªông
- [ ] Client connection management ho·∫°t ƒë·ªông
- [ ] Basic message handling
- [ ] Port 8081 accessible

---

## üéØ **Phase 2: Core System Integration (Week 3-4)**
**ALIGNED WITH PROJECT SPRINT 2: WebSocket & Real-time**

### **Task 2.1: System Controller Integration**
**Th·ªùi gian:** 3 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Phase 1 complete  
**Project Sprint:** Sprint 2 - WebSocket & Real-time

**Deliverables:**
- Integration v·ªõi `system_controller.h`
- System status endpoints
- System health endpoints
- Real-time system data

**Acceptance Criteria:**
- [ ] `/api/v1/system/status` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/system/health` endpoint ho·∫°t ƒë·ªông
- [ ] Real system data thay v√¨ mock data
- [ ] Error handling cho system failures

### **Task 2.2: Safety Manager Integration**
**Th·ªùi gian:** 3 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Task 2.1

**Deliverables:**
- Integration v·ªõi `safety_manager.h`
- Safety status endpoints
- E-Stop handling
- Safety configuration endpoints

**Acceptance Criteria:**
- [ ] `/api/v1/safety/status` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/safety/estop` endpoint ho·∫°t ƒë·ªông
- [ ] Real safety data thay v√¨ mock data
- [ ] E-Stop trigger ho·∫°t ƒë·ªông

### **Task 2.3: Module Manager Integration**
**Th·ªùi gian:** 4 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Task 2.2

**Deliverables:**
- Integration v·ªõi `module_manager.h`
- Module discovery endpoints
- Module status endpoints
- Module list management

**Acceptance Criteria:**
- [ ] `/api/v1/modules/list` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/modules/{id}/status` endpoint ho·∫°t ƒë·ªông
- [ ] Real module data thay v√¨ mock data
- [ ] Module discovery ho·∫°t ƒë·ªông

---

## üéØ **Phase 3: Module-Specific Endpoints (Week 5-6)**
**ALIGNED WITH PROJECT SPRINT 3: Security & Performance**

### **Task 3.1: Power Module Endpoints**
**Th·ªùi gian:** 4 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Phase 2 complete  
**Project Sprint:** Sprint 3 - Security & Performance

**Deliverables:**
- Integration v·ªõi `power_module_handler.h`
- Power status endpoints
- Battery monitoring endpoints
- Charging control endpoints

**Acceptance Criteria:**
- [ ] `/api/v1/modules/power/status` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/modules/power/battery` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/modules/power/charging` endpoint ho·∫°t ƒë·ªông
- [ ] Real power data thay v√¨ mock data

### **Task 3.2: Safety Module Endpoints**
**Th·ªùi gian:** 3 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Task 3.1

**Deliverables:**
- Integration v·ªõi `safety_module_handler.h`
- Safety sensor endpoints
- Safety relay endpoints
- Safety zone endpoints

**Acceptance Criteria:**
- [ ] `/api/v1/modules/safety/sensors` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/modules/safety/relays` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/modules/safety/zones` endpoint ho·∫°t ƒë·ªông
- [ ] Real safety sensor data

### **Task 3.3: Motor Module Endpoints**
**Th·ªùi gian:** 4 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Task 3.2

**Deliverables:**
- Integration v·ªõi `travel_motor_module_handler.h`
- Motor status endpoints
- Motor control endpoints
- Motor position/velocity endpoints

**Acceptance Criteria:**
- [ ] `/api/v1/modules/motor/status` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/modules/motor/control` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/modules/motor/position` endpoint ho·∫°t ƒë·ªông
- [ ] Real motor data v√† control

### **Task 3.4: Dock Module Endpoints**
**Th·ªùi gian:** 3 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Task 3.3

**Deliverables:**
- Integration v·ªõi `dock_module_handler.h`
- Dock status endpoints
- Dock control endpoints
- Docking sequence endpoints

**Acceptance Criteria:**
- [ ] `/api/v1/modules/dock/status` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/modules/dock/control` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/modules/dock/sequence` endpoint ho·∫°t ƒë·ªông
- [ ] Real dock data v√† control

---

## üéØ **Phase 4: Advanced Features (Week 7-8)**

### **Task 4.1: Configuration Management**
**Th·ªùi gian:** 4 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Phase 3 complete

**Deliverables:**
- Configuration get/set endpoints
- Configuration validation
- Configuration persistence
- Configuration export/import

**Acceptance Criteria:**
- [ ] `/api/v1/config/get` endpoint ho·∫°t ƒë·ªông
- [ ] `/api/v1/config/set` endpoint ho·∫°t ƒë·ªông
- [ ] Configuration validation ho·∫°t ƒë·ªông
- [ ] Configuration persistence ho·∫°t ƒë·ªông

### **Task 4.2: Telemetry & Real-time Data**
**Th·ªùi gian:** 4 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Task 4.1

**Deliverables:**
- Integration v·ªõi `telemetry_manager.h`
- Real-time telemetry endpoints
- WebSocket telemetry streaming
- Telemetry data serialization

**Acceptance Criteria:**
- [ ] `/api/v1/telemetry` endpoint ho·∫°t ƒë·ªông
- [ ] WebSocket telemetry streaming ho·∫°t ƒë·ªông
- [ ] Real-time data transmission
- [ ] JSON serialization ho·∫°t ƒë·ªông

### **Task 4.3: Diagnostics & Logging**
**Th·ªùi gian:** 3 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Task 4.2

**Deliverables:**
- Diagnostics endpoints
- System logging endpoints
- Error reporting endpoints
- Performance monitoring

**Acceptance Criteria:**
- [ ] `/api/v1/diagnostics` endpoint ho·∫°t ƒë·ªông
- [ ] System logging ho·∫°t ƒë·ªông
- [ ] Error reporting ho·∫°t ƒë·ªông
- [ ] Performance monitoring ho·∫°t ƒë·ªông

---

## üéØ **Phase 5: Security & Testing (Week 9-10)**

### **Task 5.1: Authentication & Authorization**
**Th·ªùi gian:** 4 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Phase 4 complete

**Deliverables:**
- Basic authentication system
- Request authorization
- Session management
- Security headers

**Acceptance Criteria:**
- [ ] Authentication system ho·∫°t ƒë·ªông
- [ ] Request authorization ho·∫°t ƒë·ªông
- [ ] Session management ho·∫°t ƒë·ªông
- [ ] Security headers implemented

### **Task 5.2: Error Handling & Validation**
**Th·ªùi gian:** 3 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Task 5.1

**Deliverables:**
- Comprehensive error handling
- Input validation
- Response validation
- Error logging

**Acceptance Criteria:**
- [ ] Error handling ho·∫°t ƒë·ªông
- [ ] Input validation ho·∫°t ƒë·ªông
- [ ] Response validation ho·∫°t ƒë·ªông
- [ ] Error logging ho·∫°t ƒë·ªông

### **Task 5.3: Integration Testing**
**Th·ªùi gian:** 3 ng√†y  
**Responsible:** FW Team  
**Dependencies:** Task 5.2

**Deliverables:**
- API integration tests
- End-to-end testing
- Performance testing
- Security testing

**Acceptance Criteria:**
- [ ] API integration tests pass
- [ ] End-to-end tests pass
- [ ] Performance requirements met
- [ ] Security requirements met

---

## üìä **Milestones & Gates**

### **Gate 1: Foundation Complete**
**Criteria:**
- [ ] Phase 1 ho√†n th√†nh 100%
- [ ] HTTP server ho·∫°t ƒë·ªông
- [ ] WebSocket server ho·∫°t ƒë·ªông
- [ ] Basic API Manager ho·∫°t ƒë·ªông

### **Gate 2: Core Integration Complete**
**Criteria:**
- [ ] Phase 2 ho√†n th√†nh 100%
- [ ] System integration ho·∫°t ƒë·ªông
- [ ] Safety integration ho·∫°t ƒë·ªông
- [ ] Module integration ho·∫°t ƒë·ªông

### **Gate 3: Module Endpoints Complete**
**Criteria:**
- [ ] Phase 3 ho√†n th√†nh 100%
- [ ] T·∫•t c·∫£ module endpoints ho·∫°t ƒë·ªông
- [ ] Real data thay v√¨ mock data
- [ ] Module control ho·∫°t ƒë·ªông

### **Gate 4: Advanced Features Complete**
**Criteria:**
- [ ] Phase 4 ho√†n th√†nh 100%
- [ ] Configuration management ho·∫°t ƒë·ªông
- [ ] Telemetry streaming ho·∫°t ƒë·ªông
- [ ] Diagnostics ho·∫°t ƒë·ªông

### **Gate 5: Production Ready**
**Criteria:**
- [ ] Phase 5 ho√†n th√†nh 100%
- [ ] Security implemented
- [ ] Testing passed
- [ ] Documentation complete

---

## üö® **Risk Management**

### **High Risk Items:**
1. **Integration Complexity** - Core systems integration c√≥ th·ªÉ ph·ª©c t·∫°p
2. **Real-time Performance** - WebSocket streaming c√≥ th·ªÉ ch·∫≠m
3. **Security Implementation** - Authentication c√≥ th·ªÉ kh√¥ng ƒë·ªß m·∫°nh

### **Mitigation Strategies:**
1. **Phased Approach** - Implement t·ª´ng phase m·ªôt c√°ch c·∫©n th·∫≠n
2. **Performance Testing** - Test performance s·ªõm v√† th∆∞·ªùng xuy√™n
3. **Security Review** - Review security implementation ·ªü m·ªói phase

---

## üìà **Success Metrics**

### **Technical Metrics:**
- [ ] 100% endpoints ho·∫°t ƒë·ªông
- [ ] Response time < 100ms cho t·∫•t c·∫£ endpoints
- [ ] WebSocket latency < 50ms
- [ ] 0 critical security vulnerabilities

### **Quality Metrics:**
- [ ] 100% test coverage cho API endpoints
- [ ] 0 memory leaks
- [ ] 0 crash trong 24h continuous operation
- [ ] 100% documentation complete

---

## üìÖ **Timeline Summary - INTEGRATED WITH PROJECT SLC**

| Phase | Duration | Start Week | End Week | Project Sprint | Status |
|-------|----------|------------|----------|----------------|--------|
| Phase 1 | 2 weeks | Week 1 | Week 2 | Sprint 1 - Firmware HTTP Server | üîÑ PLANNING |
| Phase 2 | 2 weeks | Week 3 | Week 4 | Sprint 2 - WebSocket & Real-time | ‚è≥ PENDING |
| Phase 3 | 2 weeks | Week 5 | Week 6 | Sprint 3 - Security & Performance | ‚è≥ PENDING |
| Phase 4 | 2 weeks | Week 7 | Week 8 | Sprint 4 - Backend Integration | ‚è≥ PENDING |
| Phase 5 | 2 weeks | Week 9 | Week 10 | Sprint 5 - Frontend Integration | ‚è≥ PENDING |

**Total Duration:** 10 weeks  
**Target Completion:** End of Week 10  
**Project Integration:** Aligned v·ªõi Project SLC Planning Sprint 1-5

---

**üö® L∆∞u √Ω:** Plan n√†y ph·∫£i ƒë∆∞·ª£c th·ª±c hi·ªán tu·∫ßn t·ª±, kh√¥ng ƒë∆∞·ª£c b·ªè qua phase n√†o. M·ªói phase ph·∫£i ho√†n th√†nh 100% tr∆∞·ªõc khi chuy·ªÉn sang phase ti·∫øp theo.

**üîó PROJECT INTEGRATION:** Firmware implementation ƒë√£ ƒë∆∞·ª£c integrate v·ªõi Project SLC Planning. Timeline v√† scope ƒë√£ ƒë∆∞·ª£c align ƒë·ªÉ ensure coordinated development across all teams.

**üìã MODULE DATA API FOCUS:** Implementation focus v√†o Module Data API theo CTO requirements v√† Project SLC Planning Sprint 1-3.

---

**Changelog v2.0.0:**
- ‚úÖ Integrated v·ªõi Project SLC Planning
- ‚úÖ Aligned timeline v·ªõi Project Sprint 1-5
- ‚úÖ Added Project Sprint mapping cho each phase
- ‚úÖ Updated status v√† priority
- ‚úÖ Added Module Data API focus
- ‚úÖ Enhanced integration documentation
